[English](./README.md)

# 智能 HTTP 代理

这是一个使用 Go 语言编写的轻量级智能 HTTP 代理服务器。它会根据 Gfwlist 自动分流网络请求，将特定域名的流量通过 SOCKS5 代理转发，而其他流量则直接连接。

## 功能特性

- **智能路由**: 根据 Gfwlist 规则自动代理指定域名的流量。
- **自定义域名**: 允许用户通过 `domain.txt` 文件指定需要代理的私有域名。
- **可配置**: 所有设置均可通过 `config.yaml` 文件进行管理。
- **Gfwlist 自动更新**: 根据可配置的时间表，自动保持 Gfwlist 规则为最新状态。

## 工作原理

代理服务器监听传入的 HTTP/HTTPS 请求。当收到一个请求时：
1.  检查请求的域名是否存在于自定义的 `domain.txt` 列表中。
2.  如果不在，则继续检查该域名是否匹配 Gfwlist 中的任何规则。
3.  如果域名在任一列表中被找到，该请求将被转发到预设的 SOCKS5 代理。
4.  否则，请求将直接连接到目标服务器。

## 配置

服务器采用分层配置。设置按以下优先级顺序应用：

1.  **命令行参数** (最高优先级)
2.  **`config.yaml` 配置文件**
3.  **程序默认值** (最低优先级)

这意味着您可以使用 `config.yaml` 文件进行基本配置，并在运行时通过命令行参数覆盖特定设置。

### 默认值
- **监听地址**: `:8118`
- **SOCKS5 地址**: `127.0.0.1:1080`
- **更新频率**: `24` 小时

### 1. `config.yaml` (可选)

您可以创建此文件以覆盖默认设置。

```yaml
# 代理服务器监听的地址和端口
listen_addr: ":8080"

# 您的 SOCKS5 代理服务器的地址和端口
socks5_addr: "127.0.0.1:7890"

# 更新 Gfwlist 的频率（单位：小时）
update_frequency_hours: 24
```

### 2. `domain.txt`

该文件允许您添加需要通过 SOCKS5 代理路由的个人域名。每行添加一个域名，可使用 `#` 添加注释。

```
# 在此处添加自定义域名，每行一个。
# 示例:
my-custom-domain.com
another-one.net
```

## 如何运行

### 环境要求

- Go (版本 1.18 或更高)
- 一个正在运行的 SOCKS5 代理服务器 (如果您需要访问被代理的网站)

### 步骤

1.  **安装依赖**:
    ```bash
    go mod tidy
    ```

2.  **(可选) 配置代理**:
    - 创建 `config.yaml` 文件以设置您的基本配置。
    - 在 `domain.txt` 中添加您的自定义域名。

3.  **运行服务器**:

    - **使用默认设置运行:**
      ```bash
      go run .
      ```

    - **使用 `config.yaml` 中的设置运行:**
      (只需创建该文件，然后运行上面的命令)

    - **使用命令行参数覆盖设置:**
      ```bash
      go run . -listen=":9000" -socks5="127.0.0.1:1086"
      ```

    - **显示所有参数的帮助信息:**
      ```bash
      go run . -h
      ```

代理服务器将会启动，加载配置，加载自定义域名，在必要时更新 Gfwlist，并开始监听连接。
